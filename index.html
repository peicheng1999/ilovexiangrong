<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥æŠ½å¥–</title>
    <style>
        body {
            font-family: "Arial", sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            color: #fff;
        }
        .container {
            max-width: 500px;
            margin: 50px auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        p {
            font-size: 16px;
        }
        .lottery-button, .redeem-button {
            padding: 12px 20px;
            font-size: 18px;
            cursor: pointer;
            background-color: #ffd700;
            color: #333;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            transition: 0.3s;
            margin-top: 15px;
        }
        .lottery-button:hover, .redeem-button:hover {
            background-color: #ffcc00;
        }
        .lottery-button:disabled {
            background-color: #777;
            cursor: not-allowed;
        }
        .input-container {
            margin-top: 20px;
        }
        input {
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            border: none;
            margin-right: 10px;
        }
        .message {
            font-size: 16px;
            margin-top: 10px;
        }
        .prize-image {
            max-width: 100px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‰ æ¯æ—¥æŠ½å¥– ğŸ‰</h1>
        <p>ç‚¹å‡»æŒ‰é’®è¯•è¯•ä½ çš„è¿æ°”ï¼ä½¿ç”¨å…‘æ¢ç å¯ä»¥å¢åŠ æŠ½å¥–æ¬¡æ•°ã€‚</p>
        <button id="lotteryBtn" class="lottery-button">ğŸ ç«‹å³æŠ½å¥–</button>
        <p id="result" class="message"></p>
        <img id="prizeImage" class="prize-image" src="" style="display: none;">
        
        <div class="input-container">
            <input type="text" id="codeInput" placeholder="è¾“å…¥å…‘æ¢ç ">
            <button id="redeemBtn" class="redeem-button">å…‘æ¢</button>
        </div>
        <p id="message" class="message"></p>
    </div>

    <script>
        const prizes = [
            { name: "ä¸€ç­‰å¥– ğŸ†", probability: 0.05, image: "gold_prize.png", message: "ğŸŠ å¤ªæ£’äº†ï¼ä½ èµ¢å¾—äº†ä¸€ç­‰å¥–ï¼å¥½è¿çˆ†æ£šï¼" },
            { name: "äºŒç­‰å¥– ğŸ–", probability: 0.15, image: "silver_prize.png", message: "ğŸ‰ æ­å–œä½ ï¼äºŒç­‰å¥–åˆ°æ‰‹äº†ï¼Œç»§ç»­åŠ æ²¹ï¼" },
            { name: "ä¸‰ç­‰å¥– ğŸ¥‰", probability: 0.30, image: "bronze_prize.png", message: "âœ¨ ä½ è·å¾—äº†ä¸‰ç­‰å¥–ï¼å°å¹¸è¿ä¹Ÿå¾ˆæ£’å“¦ï¼" },
            { name: "å®‰æ…°å¥– ğŸ€", probability: 0.40, image: "comfort_prize.png", message: "ğŸ€ åˆ«æ°”é¦ï¼å®‰æ…°å¥–ä¹Ÿæ˜¯å¹¸è¿çš„ä¸€éƒ¨åˆ†ï¼" },
            { name: "å†æ¥å†å‰ ğŸ˜…", probability: 0.10, image: "try_again.png", message: "ğŸ˜… å†æ¥å†å‰ï¼ä¸‹æ¬¡ä¸€å®šä¸­å¤§å¥–ï¼" }
        ];

        const validCodes = ["LUCKY2025", "BONUS123", "FREEPLAY"];
        let usedCodes = JSON.parse(localStorage.getItem("usedCodes")) || [];
        
        const lotteryBtn = document.getElementById("lotteryBtn");
        const resultText = document.getElementById("result");
        const prizeImage = document.getElementById("prizeImage");
        const codeInput = document.getElementById("codeInput");
        const redeemBtn = document.getElementById("redeemBtn");
        const messageText = document.getElementById("message");

        function getRemainingDraws() {
            let draws = parseInt(localStorage.getItem("remainingDraws"));
            if (isNaN(draws)) {
                draws = 0; // è®©ç”¨æˆ·é¦–æ¬¡è¿›å…¥é¡µé¢æ—¶æœ‰1æ¬¡æŠ½å¥–æœºä¼š
                localStorage.setItem("remainingDraws", draws);
            }
            return draws;
        }

        function setRemainingDraws(count) {
            localStorage.setItem("remainingDraws", count);
            updateButtonState();
        }

        function canDraw() {
            return getRemainingDraws() > 0;
        }

        function drawLottery() {
            if (!canDraw()) {
                resultText.innerText = "âŒ æ²¡æœ‰æŠ½å¥–æ¬¡æ•°ï¼Œè¯·ä½¿ç”¨å…‘æ¢ç è·å–æ›´å¤šæœºä¼šï¼";
                return;
            }
            
            let random = Math.random();
            let cumulativeProbability = 0;
            let selectedPrize = prizes[prizes.length - 1]; 

            for (let prize of prizes) {
                cumulativeProbability += prize.probability;
                if (random < cumulativeProbability) {
                    selectedPrize = prize;
                    break;
                }
            }
            
            resultText.innerText = selectedPrize.message;
            prizeImage.src = selectedPrize.image;
            prizeImage.style.display = "block";
            setRemainingDraws(getRemainingDraws() - 1);
        }

        function updateButtonState() {
            lotteryBtn.disabled = !canDraw();
        }

        window.onload = function() {
            updateButtonState();
        }

        lotteryBtn.addEventListener("click", drawLottery);
    </script>
</body>
</html>
